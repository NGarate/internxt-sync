# Testing with Bun

This document provides an overview of how testing is set up in the Internxt Sync project using Bun.

## Test Setup

The project uses Bun's built-in test runner which provides a Jest-like API. Tests are located in the `src/test` directory and follow the naming convention `*.test.ts`.

## Running Tests

Several npm scripts are available for running tests:

- `bun run test` - Run all working tests
- `bun run test:working` - Run the tests known to be working properly
- `bun run test:src` - Run all tests in the src/test directory
- `bun run test:all` - Run all tests in the project
- `bun run test:watch` - Run a subset of tests in watch mode
- `bun run test:coverage` - Run tests and generate coverage report

## Test Configuration

Bun tests are configured using:

1. `tsconfig.test.json` - TypeScript configuration for tests
2. `bunfig.toml` - Bun-specific configuration including module mocking

## Known Limitations

There are some tests that still fail due to module resolution issues:

1. Tests that depend on `chalk` module
   - `src/test/internxt-cli.test.ts`
   - `src/test/logger.test.ts`
   - `src/test/progress-tracker.test.ts`
   - `src/test/uploader.test.ts`

2. Tests that depend on `webdav` module
   - `src/test/webdav-client-factory.test.ts`
   - `src/test/webdav-service-composed.test.ts`
   - `src/test/webdav-service.test.ts`

3. Compiled JavaScript tests in the `dist` directory that have path resolution issues

## Mock Implementations

For the working tests, we provide mocks for:

1. `chalk` - Mocked using a simple implementation in `src/test/mocks/chalk-mock.ts`
2. `webdav` - Mocked using a simple implementation in `src/test/mocks/webdav-mock.ts`

These mocks are configured in `bunfig.toml` which allows Bun to use them during test runs.

## Test Coverage

Test coverage is generated by running `bun run test:coverage`. As of the latest run, the project has:

- Function coverage: ~73%
- Line coverage: ~81%

## Troubleshooting

If tests are failing due to module resolution issues:

1. Check that the module is properly mocked in `src/test/mocks/`
2. Verify that the mock is correctly referenced in `bunfig.toml`
3. Make sure the test is using the appropriate import syntax

## Future Improvements

1. Fix the remaining tests with module resolution issues
2. Add mocks for any other external dependencies
3. Improve test coverage for under-tested files
4. Migrate the compiled JavaScript tests to use the TypeScript source 